# Cloudinary åœ–ç‰‡ä¸Šå‚³åŸ·è¡Œé †åºèªªæ˜

## ğŸ”„ æ•´é«”åŸ·è¡Œæµç¨‹

### 1. æ¨¡çµ„è¼‰å…¥éšæ®µ (æ‡‰ç”¨å•Ÿå‹•æ™‚)

```
Next.js æ‡‰ç”¨å•Ÿå‹•
    â†“
è¼‰å…¥ lib/cloudinary.js
    â†“
åŸ·è¡Œ cloudinary.config() â† é€™è£¡å…ˆåŸ·è¡Œé…ç½®
    â†“
å®šç¾©å‡½æ•¸ (uploadImage, deleteImage ç­‰)
    â†“
åŒ¯å‡ºæ¨¡çµ„
```

### 2. API è«‹æ±‚è™•ç†éšæ®µ (ç”¨æˆ¶ä¸Šå‚³æ™‚)

```
ç”¨æˆ¶é¸æ“‡æª”æ¡ˆ
    â†“
å‰ç«¯ç™¼é€ POST è«‹æ±‚åˆ° /api/upload/avatar
    â†“
API è·¯ç”±é–‹å§‹åŸ·è¡Œ
    â†“
æª¢æŸ¥èªè­‰ (cookies, decrypt)
    â†“
è§£æ FormData
    â†“
é©—è­‰æª”æ¡ˆé¡å‹å’Œå¤§å°
    â†“
file.arrayBuffer() â† è½‰æ›ç‚º ArrayBuffer
    â†“
Buffer.from(bytes) â† è½‰æ›ç‚º Node.js Buffer
    â†“
å‘¼å« uploadImage(buffer, options)
    â†“
å»ºç«‹ uploadStream
    â†“
streamifier.createReadStream(buffer).pipe(uploadStream)
    â†“
ä¸Šå‚³åˆ° Cloudinary ä¼ºæœå™¨
    â†“
å›å‚³çµæœ
```

## ğŸ“Š é—œéµå·®ç•°èªªæ˜

### file.arrayBuffer() vs Buffer.from(bytes)

| ç‰¹æ€§         | ArrayBuffer        | Buffer                         |
| ------------ | ------------------ | ------------------------------ |
| **ç’°å¢ƒ**     | ç€è¦½å™¨æ¨™æº–         | Node.js å°ˆç”¨                   |
| **å¯è®Šæ€§**   | ä¸å¯è®Š (immutable) | å¯è®Š (mutable)                 |
| **æ“ä½œæ–¹å¼** | é€é TypedArray    | ç›´æ¥æ“ä½œ                       |
| **æ–¹æ³•**     | æœ‰é™               | è±å¯Œ (.pipe(), .toString() ç­‰) |
| **ç”¨é€”**     | åŸå§‹äºŒé€²ä½è³‡æ–™     | äºŒé€²ä½è³‡æ–™è™•ç†                 |

### è½‰æ›æµç¨‹

```javascript
File (ç€è¦½å™¨ç‰©ä»¶)
    â†“ file.arrayBuffer()
ArrayBuffer (åŸå§‹äºŒé€²ä½è³‡æ–™)
    â†“ Buffer.from()
Buffer (Node.js äºŒé€²ä½ç‰©ä»¶)
    â†“ streamifier.createReadStream()
Readable Stream
    â†“ .pipe()
Cloudinary Upload Stream
```

## âš¡ åŸ·è¡Œé †åºè©³ç´°èªªæ˜

### lib/cloudinary.js åŸ·è¡Œé †åº

1. **import éšæ®µ**: è¼‰å…¥ cloudinary æ¨¡çµ„
2. **config éšæ®µ**: åŸ·è¡Œ `cloudinary.config()` â† **æœ€å…ˆåŸ·è¡Œ**
3. **å‡½æ•¸å®šç¾©**: å®šç¾© `uploadImage`, `deleteImage` ç­‰å‡½æ•¸
4. **åŒ¯å‡ºéšæ®µ**: åŒ¯å‡ºæ¨¡çµ„ä¾›å…¶ä»–æª”æ¡ˆä½¿ç”¨

### API è·¯ç”±åŸ·è¡Œé †åº

1. **è«‹æ±‚æ¥æ”¶**: POST è«‹æ±‚åˆ°é”
2. **èªè­‰æª¢æŸ¥**: é©—è­‰ cookies å’Œ JWT
3. **æª”æ¡ˆè§£æ**: å¾ FormData æå–æª”æ¡ˆ
4. **æª”æ¡ˆé©—è­‰**: æª¢æŸ¥é¡å‹å’Œå¤§å°
5. **Buffer è½‰æ›**: ArrayBuffer â†’ Buffer
6. **ä¸Šå‚³è™•ç†**: å‘¼å« lib/cloudinary.js çš„å‡½æ•¸
7. **ä¸²æµä¸Šå‚³**: Buffer â†’ Stream â†’ Cloudinary
8. **çµæœå›å‚³**: å›å‚³ä¸Šå‚³çµæœ

## ğŸ”§ é…ç½® vs å‡½æ•¸åŸ·è¡Œ

### é…ç½® (config) åŸ·è¡Œæ™‚æ©Ÿ

- **ä½•æ™‚**: æ¨¡çµ„è¼‰å…¥æ™‚ (æ‡‰ç”¨å•Ÿå‹•)
- **é »ç‡**: åªåŸ·è¡Œä¸€æ¬¡
- **ç›®çš„**: è¨­å®š Cloudinary çš„èªè­‰è³‡è¨Š

### å‡½æ•¸åŸ·è¡Œæ™‚æ©Ÿ

- **ä½•æ™‚**: API è«‹æ±‚æ™‚
- **é »ç‡**: æ¯æ¬¡ä¸Šå‚³éƒ½åŸ·è¡Œ
- **ç›®çš„**: è™•ç†å…·é«”çš„ä¸Šå‚³é‚è¼¯

### åŸ·è¡Œé †åºç¸½çµ

```
æ‡‰ç”¨å•Ÿå‹• â†’ config åŸ·è¡Œ â†’ å‡½æ•¸å®šç¾© â†’ ç­‰å¾…è«‹æ±‚
    â†“
æ”¶åˆ°è«‹æ±‚ â†’ èªè­‰æª¢æŸ¥ â†’ æª”æ¡ˆè™•ç† â†’ å‘¼å«å‡½æ•¸ â†’ ä¸Šå‚³åŸ·è¡Œ
```

## ğŸ’¡ æ•ˆèƒ½è€ƒé‡

1. **config åªåŸ·è¡Œä¸€æ¬¡**: é¿å…é‡è¤‡è¨­å®š
2. **Buffer è½‰æ›**: å¿…è¦çš„æ ¼å¼è½‰æ›
3. **Stream è™•ç†**: é¿å…è¨˜æ†¶é«”æº¢å‡º
4. **éåŒæ­¥è™•ç†**: ä¸é˜»å¡å…¶ä»–è«‹æ±‚

## ğŸš¨ æ³¨æ„äº‹é …

1. **ç’°å¢ƒè®Šæ•¸**: ç¢ºä¿ CLOUDINARY\_\* è®Šæ•¸å·²è¨­å®š
2. **æª”æ¡ˆå¤§å°**: éµå®ˆè¨­å®šçš„é™åˆ¶ (é ­è²¼ 2MB, ä¸€èˆ¬åœ–ç‰‡ 5MB)
3. **éŒ¯èª¤è™•ç†**: æ¯å€‹éšæ®µéƒ½æœ‰é©ç•¶çš„éŒ¯èª¤è™•ç†
4. **è¨˜æ†¶é«”ç®¡ç†**: ä½¿ç”¨ Stream é¿å…å¤§æª”æ¡ˆè¼‰å…¥è¨˜æ†¶é«”





